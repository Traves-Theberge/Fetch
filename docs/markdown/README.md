# ğŸ• Fetch - Your Faithful Code Companion

> âš ï¸ **BETA PROJECT** â€” Experimental software. Review security implications before deployment.

A headless "ChatOps" development environment. Send natural language coding tasks via WhatsApp and let AI agents do the work. Fetch is a good boy who just wants to help! ğŸ• (But he hates lobsters ğŸ¦)

```
  â €â €â €â €â €â €â €â¢€â£ â£¤â£ â£¶â šâ ›â ¿â ·â ¶â£¤â£€â¡€â €â €â €â €â €â €â €â €â €â €                                             
  â €â €â €â €â €â¢€â£´â Ÿâ ‰â €â €â¢ â¡„â €â €â €â €â €â ‰â ™â ³â£„â €â €â €â €â €â €â €â €                                             
  â €â €â €â¢€â¡´â ›â â €â €â €â €â ˜â£·â£´â â €â €â£ â¡„â €â €â¢¨â¡‡â €â €â €â €â €â €â €    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
  â €â €â €â ºâ£‡â €â €â €â €â €â €â €â ˜â£¿â €â €â ˜â£»â£»â¡†â €â €â ™â ¦â£„â£€â €â €â €â €    â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
  â €â €â €â¢°â¡Ÿâ¢·â¡„â €â €â €â €â €â €â¢¸â¡„â €â €â €â €â €â €â €â €â €â €â ‰â¢»â ¶â¢¤â¡€    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘
  â €â €â €â£¾â£‡â €â »â£„â €â €â €â €â €â¢¸â¡‡â €â €â €â €â €â €â €â €â €â €â €â ¸â£€â£´â£¿    â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘
  â €â €â¢¸â¡Ÿâ »â£†â €â ˆâ ³â¢„â¡€â €â €â¡¼â ƒâ €â €â €â €â €â €â €â €â €â ¶â ¶â¢¤â£¬â¡¿â     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘
  â €â¢€â£¿â ƒâ €â ¹â£†â €â €â €â ™â “â ¿â¢§â¡€â €â¢ â¡´â£¶â£¶â£’â£‹â£€â£€â£¤â£¶â£¶â Ÿâ â €    â•šâ•â•     â•šâ•â•â•â•â•â•â•   â•šâ•â•    â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•
  â €â£¼â¡â €â €â €â ™â €â €â €â €â €â €â €â ™â ³â ¶â ¤â µâ£¶â ’â šâ »â ¿â ‹â â €â €â €â €                                             
  â¢°â£¿â¡‡â €â €â €â €â €â €â €â£†â €â €â €â €â €â €â €â¢ â£¿â €â €â €â €â €â €â €â €â €â €    Your Faithful Code Companion                  
  â¢¿â¡¿â â €â €â €â €â €â €â €â ˜â£¦â¡€â €â €â €â €â €â¢¸â£¿â €â €â €â €â €â €â €â €â €â €                  
  â €â €â €â €â €â €â €â €â €â €â €â ˆâ »â£·â¡„â €â €â €â €â£¿â£§â €â €â €â €â €â €â €â €â €                                             
  â €â €â €â €â €â €â €â €â €â €â €â €â €â ˆâ¢·â¡€â €â €â €â¢¸â£¿â¡„â €â €â €â €â €â €â €â €                                             
  â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ¸â£¿â ‡â €â €â €â €â €â €â €â €                                             
```

## ğŸ¯ Overview

Fetch is a **lightweight orchestrator** that delegates coding tasks to specialized AI harnesses (Claude Code, Gemini CLI, GitHub Copilot CLI) while managing conversation state and user interaction via WhatsApp.

**Personality:** Fetch is a loyal coding companion - eager, helpful, and always ready to fetch code for you! He uses dog expressions like "Let me fetch that!" and "Good boy reporting back!" and *really* hates lobsters ğŸ¦ (weird ocean bugs with anger issues).

### ğŸ—ï¸ V2 Orchestrator Architecture

Fetch automatically classifies your intent and routes to the appropriate handler:

| Intent | When | Action | Example |
|--------|------|--------|---------|
| ğŸ’¬ **Conversation** | Greetings, thanks, chat | Direct response | "Hey!", "Thanks!" |
| ğŸ“ **Workspace** | Project management | Tool calls | "List projects", "Switch to api" |
| ğŸš€ **Task** | Coding work | Delegate to harness | "Add dark mode", "Fix the bug" |

### ğŸ¤– Harness System

Fetch delegates actual coding work to specialized CLI tools:

| Harness | CLI | Best For |
|---------|-----|----------|
| **Claude Code** | `claude` | Complex refactoring, multi-file changes |
| **Gemini CLI** | `gemini` | Quick edits, explanations |
| **Copilot CLI** | `gh copilot` | Suggestions, command help |

### ğŸ§  Smart Capabilities

- **ğŸ—ºï¸ Repo Maps:** Fetch scans your project structure to understand the architecture, exports, and relationships between files.
- **ğŸ™ï¸ Voice Mode:** Send voice notes on WhatsApp! Fetch transcribes them using Whisper and executes them as commands.
- **ğŸ‘€ Vision:** Send screenshots of errors or UI designs. Fetch uses GPT-4o Vision to understand what he's looking at.
- **ğŸŒŠ Streaming:** Get real-time updates as Fetch works (e.g., "ğŸ“ Editing src/index.ts...").

### ğŸ› ï¸ 11 Orchestrator Tools

| Category | Tools | Purpose |
|----------|-------|---------|
| **Workspace** | `workspace_list`, `workspace_select`, `workspace_status`, `workspace_create`, `workspace_delete` | Project management |
| **Task** | `task_create`, `task_status`, `task_cancel`, `task_respond` | Task lifecycle |
| **Interaction** | `ask_user`, `report_progress` | User communication |

## ğŸ—ï¸ Architecture

> ğŸ“Š **Interactive diagrams available at [http://localhost:8765/docs](http://localhost:8765/docs)** when the bridge is running.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              HOST MACHINE                                  â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ›ï¸ Manager  â”‚         â”‚            ğŸ³ Docker Compose               â”‚  â”‚
â”‚  â”‚    (Go TUI)  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚  â”‚
â”‚  â”‚              â”‚         â”‚  â”‚  ğŸŒ‰ Bridge  â”‚      â”‚  ğŸ  Kennel  â”‚      â”‚  â”‚
â”‚  â”‚ â€¢ Start/Stop â”‚         â”‚  â”‚   (Node.js) â”‚â—„â”€â”€â”€â”€â–ºâ”‚   (Ubuntu)  â”‚      â”‚  â”‚
â”‚  â”‚ â€¢ Configure  â”‚         â”‚  â”‚             â”‚      â”‚             â”‚      â”‚  â”‚
â”‚  â”‚ â€¢ View Logs  â”‚         â”‚  â”‚ WhatsApp    â”‚      â”‚ Claude CLI  â”‚      â”‚  â”‚
â”‚  â”‚ â€¢ Model Sel. â”‚         â”‚  â”‚ Security    â”‚      â”‚ Gemini CLI  â”‚      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚ Agent Core  â”‚      â”‚ Copilot CLI â”‚      â”‚  â”‚
â”‚                           â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚  â”‚
â”‚                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€-â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚                    â”‚                â”‚
â”‚                                     â–¼                    â–¼                â”‚
â”‚                              ğŸ“± WhatsApp          ğŸ“ /workspace           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Message Flow

```
    ğŸ“± WhatsApp Message
            â”‚
            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ğŸ§  Intent     â”‚
    â”‚   Classifier  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼       â–¼       â–¼           â–¼
   ğŸ’¬      ğŸ”      âš¡          ğŸ“‹
  Chat   Inquiry  Action      Task
    â”‚       â”‚       â”‚           â”‚
    â–¼       â–¼       â–¼           â–¼
 Direct  Read-only Full Tools  ReAct
Response  Tools   (1 cycle)    Loop
    â”‚       â”‚       â”‚           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
             âœ… WhatsApp Reply
```

## ğŸš€ Quick Start

### Prerequisites
- Linux machine (any architecture)
- Docker & Docker Compose
- Go 1.21+ (for manager)
- Node.js 20+ (for development)

### Installation

1. **Clone the repository**
   ```bash
   git clone https://github.com/yourusername/fetch.git
   cd fetch
   ```

2. **Configure environment**
   ```bash
   cp .env.example .env
   # Edit .env with your API keys and phone number
   ```

3. **Start with Docker Compose**
   ```bash
   docker compose up -d
   ```

4. **Scan WhatsApp QR Code**
   ```bash
   docker logs -f fetch-bridge
   # Scan the QR code that appears
   ```

### Using the Manager TUI

```bash
cd manager
go run .
```

The TUI provides a beautiful terminal interface with:
- ğŸ¨ **Horizontal Layout** - ASCII dog mascot on the left, menu on the right
- ğŸ“ **Bottom-Aligned UI** - Content aligned to bottom with status bar
- ğŸ• **Neofetch-Style Version** - Press `v` for detailed system info

**Menu Options:**
- ğŸ”§ Setup - First-time configuration wizard
- â–¶ï¸  Start - Launch Bridge & Kennel containers
- â¹ï¸  Stop - Stop running services
- âš™ï¸  Configure - Edit environment variables
- ğŸ¤– Select Model - Choose AI model via OpenRouter
- ğŸ“œ Logs - View container logs
- ğŸ“š Documentation - Open docs in browser
- â„¹ï¸  Version - System information
- ğŸšª Exit - Quit the TUI

## ğŸ“± WhatsApp Commands

| Command | Description |
|---------|-------------|
| `help` | Show available commands |
| `status` | Check system and task status |
| `ping` | Test if Fetch is responsive |

### Project Management

| Command | Description |
|---------|-------------|
| `/projects` | List available projects in workspace |
| `/project <name>` | Switch to a specific project |
| `/clone <url>` | Clone a git repository |
| `/init <name>` | Initialize a new project |
| `/status` | Show git status |
| `/diff` | Show current changes |
| `/log [n]` | Show recent commits |

### Natural Language Examples

Just describe what you need:

| You Say | Intent | What Happens |
|---------|--------|--------------|
| "Hey Fetch!" | ğŸ’¬ Conversation | Direct response, no tools |
| "What projects are open?" | ğŸ“ Workspace | Lists workspaces via tools |
| "Build a REST API for users" | ğŸš€ Task | Delegates to harness (Claude/Gemini/Copilot) |
| "Create a login form component" | ğŸš€ Task | AI plans & executes multi-step work |
| "Help me debug this error" | ğŸš€ Task | AI analyzes code, proposes fixes |

## ğŸ”’ Security

Fetch is designed with security as a top priority:

- **Whitelist Only**: Only responds to `OWNER_PHONE_NUMBER`
- **@fetch Trigger**: All messages must start with `@fetch` prefix
- **Zod Validation**: Runtime type checking for all tool arguments
- **No Shell Injection**: Commands use array-based argument passing
- **Rate Limiting**: 30 requests per minute maximum
- **Input Validation**: Sanitizes all user input
- **Path Traversal Protection**: Blocks `..` in file paths
- **Docker Isolation**: AI agents run in sandboxed containers
- **Read-Only Configs**: Auth tokens mounted as read-only

## ğŸ“ Project Structure

```
fetch/
â”œâ”€â”€ manager/                 # Go TUI for system management
â”‚   â”œâ”€â”€ main.go
â”‚   â””â”€â”€ internal/
â”‚       â”œâ”€â”€ config/         # .env editor
â”‚       â”œâ”€â”€ docker/         # Container control
â”‚       â”œâ”€â”€ logs/           # Log viewer
â”‚       â””â”€â”€ update/         # Git update
â”œâ”€â”€ fetch-app/              # Node.js Bridge
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ bridge/         # WhatsApp client
â”‚       â”œâ”€â”€ security/       # Auth, rate limiting, validation
â”‚       â”œâ”€â”€ agent/          # V2 Orchestrator (core, intent, prompts)
â”‚       â”œâ”€â”€ harness/        # CLI adapters (Claude, Gemini, Copilot)
â”‚       â”œâ”€â”€ session/        # Session management
â”‚       â”œâ”€â”€ tools/          # 8 orchestrator tools + Zod schemas
â”‚       â”œâ”€â”€ executor/       # Docker exec wrapper
â”‚       â”œâ”€â”€ tasks/          # Task persistence
â”‚       â””â”€â”€ utils/          # Logger, sanitizer
â”‚   â””â”€â”€ tests/              # Vitest test suite
â”‚       â”œâ”€â”€ unit/           # Unit tests
â”‚       â”œâ”€â”€ integration/    # Integration tests
â”‚       â””â”€â”€ e2e/            # End-to-end tests
â”œâ”€â”€ kennel/                 # AI CLI container
â”‚   â””â”€â”€ Dockerfile
â”œâ”€â”€ config/                 # Auth token mounts
â”‚   â”œâ”€â”€ claude/
â”‚   â””â”€â”€ github/
â”œâ”€â”€ workspace/              # Code sandbox
â”œâ”€â”€ data/                   # Persistent data
â””â”€â”€ docker-compose.yml
```

## âš™ï¸ Configuration

### Required Environment Variables

| Variable | Description |
|----------|-------------|
| `OWNER_PHONE_NUMBER` | Your WhatsApp number (e.g., `15551234567`) |
| `OPENROUTER_API_KEY` | API key from [OpenRouter](https://openrouter.ai) |
| `AGENT_MODEL` | OpenRouter model ID (default: `openai/gpt-4o-mini`) |
| `ANTHROPIC_API_KEY` | API key for Claude |
| `GEMINI_API_KEY` | API key for Gemini |

### GitHub Copilot Authentication

1. On a machine with a browser:
   ```bash
   gh auth login
   ```

2. Copy the hosts file:
   ```bash
   cp ~/.config/gh/hosts.json ./config/github/
   ```

## ğŸ“ License

MIT

## ğŸ™ Acknowledgments

- [whatsapp-web.js](https://github.com/pedroslopez/whatsapp-web.js) - WhatsApp Web API
- [Bubble Tea](https://github.com/charmbracelet/bubbletea) - TUI framework
- [OpenRouter](https://openrouter.ai) - AI model routing
